{% extends "_base.html" %}
{% load ucp_extras %}

{% block content %}

<div class="bg-white">
  <div class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8">
    <div class="lg:grid lg:grid-cols-2 lg:items-start lg:gap-x-8">
      <div class="flex flex-col-reverse">
        <div class="mx-auto mt-6 w-full max-w-2xl sm:block lg:max-w-none">
          <div class="grid grid-cols-4 gap-6 gallery" aria-orientation="horizontal" role="tablist">

            {% for each in photos %}
              <button data-target="{{ each.large }}" id="tabs-1-tab-1" class="relative flex h-24 cursor-pointer items-center justify-center rounded-md bg-white text-sm font-medium uppercase text-gray-900 hover:bg-gray-50 focus:outline-none focus:ring focus:ring-sky-500/50 focus:ring-offset-4" aria-controls="tabs-1-panel-1" role="tab" type="button" data-credit="{{ each.credit }}">
                <span class="absolute inset-0 rounded-md">
                  <img src="{{ each.thumbnail }}" alt="" class="size-full object-cover">
                </span>
                <span class="pointer-events-none absolute inset-0 rounded-md ring-2 {% if forloop.counter == 1 %}ring-sky-500{% else %}ring-transparent{% endif %} ring-offset-2" ></span>
              </button>
            {% endfor %}

          </div>
        </div>

        <div>
          <div id="headshot" aria-labelledby="headshot" tabindex="0" class="relative">
            <img src="{{ photos.0.large }}" alt="" class="aspect-square w-full object-cover sm:rounded-lg">
            <span id="credit" class="absolute text-sm bg-gray-50 opacity-90 p-1 rounded-tr-md" style="bottom:0;">{{ photos.0.credit }}</span>
          </div>
        </div>
      </div>

      <div class="mt-10 px-4 sm:mt-16 sm:px-0 lg:mt-0">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900">{{ details.common_name }}</h1>

        <div class="mt-3">
          <h2 class="sr-only">Product information</h2>
          <p class="text-3xl tracking-tight text-gray-900">{{ info }}</p>
        </div>

        <p class="mt-6 text-base/7 text-gray-600">
          {% if details.description %}
          {{ details.description|linebreaksbr }}
          {% elif details.description_wikipedia %}
            {% if details.summary_wikipedia %}
              <strong>{{ details.summary_wikipedia|linebreaksbr }}</strong><br><br>
            {% endif %}
            {{ details.description_wikipedia|linebreaksbr }}
          {% endif %}
        </p>

        {% if sources %}
          <h3 class="mt-10">{{ _("Inclusion rationale") }}</h3>

          <p>{{ _("Why did we include this species on our website? Because it was mentioned in the following source(s):") }}</p>

          <ul class="list-disc ml-4 mt-3">
            {% for each in sources %}
              <li><a href="{% url "species_source" each.file.attached_to.id %}">{{ each.file.attached_to }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}

        <h3 class="mt-10">{{ _("Sources and references") }}</h3>
        <ul class="flex list-none space-x-4">
        {% for each in info.links %}
          <li><a href="{{ each }}" class="no-underline rounded-md bg-sky-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:text-white hover:bg-sky-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600">{{ each|domain }}</a></li>
        {% endfor %}
        </ul>

      </div>
    </div>
  </div>
</div>

{% if request.user.is_staff %}
  <a class="btn-warning btn-edit" href="{% url "controlpanel_species" info.id %}?redirect={{ request.get_full_path }}">
    <i class="fa fa-pencil"></i>
  </a>
{% endif %}

{% endblock %}

{% block js %}
  <script type="text/javascript">
  $(function(){

    $(".gallery button").click(function(){
      var url = $(this).data("target");
      var credit = $(this).data("credit");
      img = $("#headshot img");
      thumbnail = $(this).find("img");
      img.attr("src", thumbnail.attr("src")); // While the large image loads, we show the thumbnail (instantly as it's already shown on page)
      img.attr("src", url);
      $("#credit").html(credit);
      $(".gallery button .ring-sky-500").removeClass("ring-sky-500").addClass("ring-transparent");
      $(this).find(".ring-2").removeClass("ring-transparent").addClass("ring-sky-500");
    });

    $("#refresh").click(function(){
      $("#inat_modal").show("fast");
    });
    
  });
  </script>
{% endblock %}
