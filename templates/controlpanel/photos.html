{% extends "_base.html" %}

{% block title %}
  {{ _("Photos") }}
{% endblock %}
{% block content %}

{% block css %}
  <style>
    .select2-container--default .select2-selection--single .select2-selection__arrow b {
      display:none;
    }
    .select2-container--default .select2-selection--single {
      height:40px;
      padding-top:5px;
      padding-left:10px;
      border: 1px solid #d1d5db; /* Gray border */
      border-radius: 0.5rem; /* Rounded corners */
    }
    .select2-container--default .select2-selection--single.select2-selection--focus {
      border-color: #3b82f6; /* Sky-700 border on focus */
      box-shadow: 0 0 0 0.2rem rgba(59, 130, 247, 0.25); /* Sky-700 shadow ring */
    }
    .select2-container--default .select2-selection__placeholder {
      color: #6b7280; /* Gray color for placeholder */
    }
    .select2-container--default .select2-selection__rendered {
      color: #374151; /* Text color */
    }
    .select2-container--default .select2-search--dropdown .select2-search__field {
      border-radius: 0.25rem;
    }
  </style>
{% endblock %}

<h1 class="text-3xl">{{ _("Photos") }}</h1>

<div class="mb-5 max-w-md mx-auto p-6 border border-gray-300 rounded-lg shadow-md">

  <div class="mb-4">
    <label for="city" class="block text-sm font-medium text-gray-700 mb-2">{{ _("Garden") }}</label>
    <select data-name="garden" class="block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-300">
      <option value=""></option>
      {% for each in gardens %}
        <option value="{{ each.id }}" {% if request.GET.table == "garden" and request.GET.id == each.id|slugify %}selected{% endif %}>{{ each }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-4">
    <label for="city" class="block text-sm font-medium text-gray-700 mb-2">{{ _("Single species") }}</label>
    <select id="search_species" class="block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-300">
      {% if species and not request.GET.species_search %}
        <option value="{{ species.id }}">{{ species }}</option>
      {% endif %}
    </select>
  </div>

  <form method="get">
    <div class="mb-4">
      <label for="city" class="block text-sm font-medium text-gray-700 mb-2">{{ _("Multiple species") }}</label>
      <input name="species_search" class="block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-300"
        value="{{ request.GET.species_search }}"
      >
    </div>
  </form>

  <div class="mb-4">
    <label for="city" class="block text-sm font-medium text-gray-700 mb-2">{{ _("Page") }}</label>
    <select data-name="page" class="block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-300">
      <option value=""></option>
      {% for each in pages %}
        <option value="{{ each.id }}" {% if request.GET.table == "page" and request.GET.id == each.id|slugify %}selected{% endif %}>{{ each }}</option>
      {% endfor %}
    </select>
  </div>
</div>

{% if "id" in request.GET or "species_search" in request.GET %}
  <div class="alert alert-info">{{ photos.count }} {{ _("photos found") }}</div>

  <ul role="list" class="mt-5 grid grid-cols-2 gap-x-4 gap-y-8 sm:grid-cols-3 sm:gap-x-6 lg:grid-cols-4 xl:gap-x-8">
    {% for each in photos %}
      <li class="relative bg-gray-100 rounded-lg">
        <div class="group overflow-hidden rounded-t-lg bg-gray-100 focus-within:ring-2 focus-within:ring-indigo-500 focus-within:ring-offset-2 focus-within:ring-offset-gray-100">
          <a class="" href="{% url "controlpanel_photo" each.id %}">
            <img src="{{ each.thumbnail }}" alt="" class="w-full h-full object-cover group-hover:opacity-75" style="height:210px">
          </a>
        </div>
        <div class="m-3">
          <p class="mt-2 mb-0 block truncate text-sm font-medium text-gray-900 flex justify-between">
            <span>
              {{ each.id }}
            </span>
            <span>
              {{ each.license }}
            </span>
          </p>
          <p class="block text-sm font-medium text-gray-500"><em>{{ each.species.name }}</em></p>
        </div>
      </li>
    {% endfor %}
  </ul>
{% endif %}

{% endblock %}

{% block js %}
  <script type="text/javascript">
    $(function(){
      $("#search_species").select2({
        minimumInputLength: 3,
        ajax: {
          delay: 150,
          url: "{% url "ajax_species" %}?active_only=true",
          dataType: "json",
          processResults: function(data) {
            return {
              results: $.map(data, function(item) {
                return {
                  id: item.id,
                  text: item.name,
                  common_name: item.common_name,
                  active: item.active
                };
              })
            };
          }
        },
        templateResult: function(item) {
          const dotColor = item.active ? "text-lime-500" : "text-gray-700";
          const dotIcon = item.active ? "fa-circle" : "fa-circle" + " text-gray-700";
          
          return $("<div class='flex items-center'>" +
                   "<i class='fa " + dotColor + " " + dotIcon + "'></i>" +
                   "<em class='ml-2 " + (item.active ? "text-black" : "text-gray-700") + "'>" + item.text + "</em>" + 
                   "<span class='ml-2 " + (item.active ? "text-black" : "text-gray-700") + "'>" + item.common_name + "</span>" + 
                   "</div>");
        }
      }).on("select2:select", function (e) {
        const id = e.params.data.id;
        window.location.href = "?table=species&id=" + id;
      });

      $("select").change(function() {
        // Get the data-name and the selected value
        var table = $(this).data("name");
        var id = $(this).val();
        window.location.href = "?table=" + encodeURIComponent(table) + "&id=" + id;
      });

    });
  </script>
{% endblock %}
