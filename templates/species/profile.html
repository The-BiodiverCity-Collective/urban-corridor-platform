{% extends "_base.html" %}
{% load ucp_extras %}

{% block css %}
  <style type="text/css">
    .features svg{max-height:24px;max-width:24px;color:#fff;display:inline}
  </style>
{% endblock %}

{% block content %}

  <div class="absolute top-2 right-2">
    <a href="{% url "species_data" info.id %}" class="btn-blue btn-sm">
      <i class="fa fa-info mr-2"></i>
      {{ _("Data sources") }}
    </a>
  </div>

  <div class="mx-auto max-w-2xl px-4 sm:px-6 pt-5 pb-5 lg:max-w-7xl lg:px-8">
    <div class="lg:grid lg:grid-cols-2 lg:items-start lg:gap-x-8 mb-5">
      <div class="flex flex-col-reverse">
        <div class="mx-auto mt-6 w-full max-w-2xl sm:block lg:max-w-none">
          <div class="grid grid-cols-4 gap-6 gallery" aria-orientation="horizontal" role="tablist">

            {% for each in photos %}
              <button data-target="{{ each.large }}" id="tabs-1-tab-1" class="relative flex h-24 cursor-pointer items-center justify-center rounded-md bg-white text-sm font-medium uppercase text-gray-900 hover:bg-gray-50 focus:outline-hidden focus:ring-3 focus:ring-sky-500/50 focus:ring-offset-4" aria-controls="tabs-1-panel-1" role="tab" type="button" data-credit="{{ each.credit }}">
                <span class="absolute inset-0 rounded-md">
                  <img src="{{ each.thumbnail }}" alt="" class="size-full object-cover">
                </span>
                <span class="pointer-events-none absolute inset-0 rounded-md ring-2 {% if each == photo %}ring-sky-500{% else %}ring-transparent{% endif %} ring-offset-2" ></span>
              </button>
            {% endfor %}

          </div>
        </div>

        <div>
          <div id="headshot" aria-labelledby="headshot" tabindex="0" class="relative">
            <img src="{{ photo.large }}" alt="" class="aspect-square w-full object-cover sm:rounded-lg">
            <span id="credit" class="absolute text-sm bg-gray-50 opacity-90 p-1 rounded-tr-md" style="bottom:0;">{{ photo.credit }}</span>
          </div>
        </div>

      </div>

      <div class="mt-10 px-4 sm:mt-16 sm:px-0 lg:mt-0">
        {% if details.common_name %}
          <h1 class="text-3xl font-bold tracking-tight text-gray-900 mb-1">{{ details.common_name }}</h1>
        {% endif %}
        <p class="text-3xl tracking-tight text-gray-900"><em>{{ info }}</em></p>

        {% if info.features %}
          <section class="container mx-auto features mt-5">
            <div class="grid grid-cols-2 gap-4">
              {% for each in info.features.all %}
                {% ifchanged each.species_type %}
                  {% if not forloop.first %}
                  </div>
                  {% endif %}
                  <div class="bg-gray-100 p-3 rounded">
                  <h3 class="text-sky-700">{{ each.get_species_type_display }}</h3>
                {% endifchanged %}
                <div class="mb-1">
                  {% if each.icon or each.icon_svg %}
                    <span class="mr-1 relative">
                      {{ each.get_icon }}
                    </span>
                  {% endif %}
                  <a href="/species/list/?feature={{ each.id }}" class="text-gray-700 hover:text-black font-normal hover:underline no-underline">
                    {{ each }}
                  </a>
                </div>
              {% endfor %}
            </div>
          </section>

        {% endif %}

        <div class="rounded bg-gray-100 mt-5 p-3">
          <div class="flex justify-between">
            <h3 class="text-sky-700">{{ _("Flowering") }}</h3>
            <ul>
              {% for color in info.colors.all %}
                <li class="colorbox" style="background:{{ color.color }}" title="{{ color }}">
                  <span class="sr-only">{{ color }}</span>
                </li>
              {% endfor %}
            </ul>
          </div>
          {% if info.flowering %}
            <div>
              {% for month in info.flowering_months %}
                  <span class="badge-success">{{ month }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <p class="mt-6 text-base/7 text-gray-600">
          {% if details.description %}
          {{ details.description|linebreaksbr }}
          {% elif details.description_wikipedia %}
            {% if details.summary_wikipedia %}
              <strong>{{ details.summary_wikipedia|linebreaksbr }}</strong><br><br>
            {% endif %}
            {{ details.description_wikipedia|linebreaksbr }}
          {% endif %}
        </p>


        {% if sources %}
          <h3 class="mt-10">{{ _("Inclusion rationale") }}</h3>

          <p>{{ _("Why did we include this species on our website? Because it was mentioned in the following source(s):") }}</p>

          <ul class="list-disc ml-4 mt-3">
            {% for each in sources %}
              <li><a href="{% url "species_source" each.file.attached_to.id %}">{{ each.file.attached_to }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}

      </div>
    </div>
  </div>

  <div class="px-4 sm:px-6 lg:px-8 pb-10">
    {% if details.propagation_seed or details.propagation_cutting %}
      <div class="lg:grid lg:grid-cols-2 lg:items-start lg:gap-x-8 bg-gray-100 p-5 mb-5 rounded">
        {% if details.propagation_seed %}
          <section>
            <h3>{{ _("Propagation by seed") }}</h3>
            {{ details.propagation_seed|linebreaksbr }}
          </section>
        {% endif %}

        {% if details.propagation_cutting %}
          <section>
            <h3>{{ _("Propagation by cutting") }}</h3>
            {{ details.propagation_cutting|linebreaksbr }}
          </section>
        {% endif %}
      </div>
    {% endif %}

    {% if garden %}
      <section class="bg-gray-100 rounded p-5">
        <h3><i class="fas fa-shovel"></i> {{ _("Garden planner") }} - {{ garden }}</h3>
        <div class="flex justify-between">
          <div>
            <button data-action="PRESENT" class="planner-action {% if in_garden.status == "PRESENT" %}btn-green{% else %}btn-white{% endif %} mb-3 mr-3 cursor-pointer">
              <i class="fa fa-check-circle mr-1"></i>
              <i class="fa fa-certificate mr-1"></i>
              {{ _("I have this in my garden") }}
            </button>
            <button data-action="FUTURE" class="planner-action {% if in_garden.status == "FUTURE" %}btn-green{% else %}btn-white{% endif %} mb-3 mr-3 cursor-pointer">
              <i class="fa fa-check-circle mr-1"></i>
              <i class="fa fa-certificate mr-1"></i>
              {{ _("I want this in my garden") }}
            </button>
          </div>
          <div>
          <a href="{% url "planner" garden.id %}" class="no-underline rounded-md bg-orange-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:text-white hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 flex mb-3 mr-3">
            <i class="fa fa-shovel mr-2 relative" style="top:2px"></i>
            {{ _("Go to garden planner") }}
          </a>
          </div>
        </div>
      </section>
    {% endif %}

    <section>
      <h3 class="mt-10">{{ _("Sources and references") }}</h3>
      <ul class="flex flex-wrap list-none">
      {% for label,url in info.get_links.items %}
        <li>
          <a href="{{ url }}" class="btn-blue mr-2">
            <i class="fa fa-link mr-1"></i> 
            {{ label }}
          </a>
        </li>
      {% endfor %}

        <li>
          <a href="{% url "species_data" info.id %}" class="btn-blue">
            <i class="fa fa-info mr-2"></i>
            {{ _("Data sources") }}
          </a>
        </li>
      </ul>
    </section>

  </div>

  {% if request.user.is_staff %}
    <a class="btn-warning btn-edit" href="{% url "controlpanel_species" info.id %}?redirect={{ request.get_full_path }}">
      <i class="fa fa-pencil"></i>
    </a>
  {% endif %}

  {% if garden %}
    {% include "_gardenmanager.js.html" %}
  {% endif %}

{% endblock %}

{% block js %}
  <script type="text/javascript">
  $(function(){

    $(".gallery button").click(function(){
      var url = $(this).data("target");
      var credit = $(this).data("credit");
      img = $("#headshot img");
      thumbnail = $(this).find("img");
      img.attr("src", thumbnail.attr("src")); // While the large image loads, we show the thumbnail (instantly as it's already shown on page)
      img.attr("src", url);
      $("#credit").html(credit);
      $(".gallery button .ring-sky-500").removeClass("ring-sky-500").addClass("ring-transparent");
      $(this).find(".ring-2").removeClass("ring-transparent").addClass("ring-sky-500");
    });

    $("#refresh").click(function(){
      $("#inat_modal").show("fast");
    });


    $("#close_modal").click(function(){
      $("#dialog").hide();
    });

  });
  </script>
{% endblock %}
