{% extends "_base.html" %}

{% block content %}

<h1>{% block title %}Species{% endblock %}</h1>
{% if vegetation_type %}
  <h2>
    {{ vegetation_type }}
  </h2>
  <div class="alert alert-warning">
    There are <strong>{{ all }}</strong> species found in this vegetation type.
    Use the filters below to locate the species of your interest.
    <br>
    <br>
    <a href="{% url "species_full_list" %}{{ veg_link }}">View all {{ all }} species</a><br>
    <a href="{% url "species" %}">Back to main species list</a>
  </div>
{% endif %}

{% with species_list=samples %}
  {% include "_species.list.html" %}
{% endwith %}

<div class="bg-gray-100 p-5 mt-10">
  <h2>{{ _("Search species list") }}</h2>
  <form action="{% url "species_search" %}">
    {% if vegetation_type %}
      <input type="hidden" name="vegetation_type" value="{{ vegetation_type.id }}" />
    {% endif %}

    <div class="mb-4 bg-gray-100 p-4">
      <div class="container mx-auto">
        <div class="grid grid-cols-3 gap-4">
          {% for feature in features %}
            {% ifchanged feature.species_type %}
              {% if not forloop.first %}
              </div>
              {% endif %}
              <div>
                <h4>{{ feature.get_species_type_display }}</h4>
            {% endifchanged %}
            <span class="flex items-center">
              <input type="checkbox" name="feature" id="id_features_{{ feature.id }}" value="{{ feature.id }}" class="form-checkbox h-5 w-5 text-blue-500" {% if feature in info.features.all %} checked {% endif %}>
              <label for="id_features_{{ feature.id }}" class="ml-2 text-gray-700">{{ feature.name }}</label>
            </span>
          {% endfor %}
        </div>
        </div>
      </div>
    </div>

    <div class="mt-4 flex gap-2">
      <select name="search" class="w-5/6">
        <option value="all">Match ALL of these properties</option>
        <option value="any">Match ANY one of these properties</option>
      </select>
      <button type="submit" class="btn-blue bg-gray-600 w-1/6"><i class="fa fa-search fa-fw"></i> Search</button>
    </div>

  </form>

</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 mt-10">
  <div>
    <h2>Browse by genus</h2>
    <table class="table table-striped datatable">
      <thead>
        <tr>
          <th>Genus</th>
          <th>Species</th>
        </tr>
      </thead>
      <tbody>
      {% for each in genus %}
        <tr>
          <td><a href="{% url "genus" each.id %}{{ veg_link }}">{{ each }}</a></td>
          <td>{{ each.total }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div>
    <h2>Browse by family</h2>
    <table class="table table-striped datatable">
      <thead>
        <tr>
          <th>Family</th>
          <th>Species</th>
        </tr>
      </thead>
      <tbody>
      {% for each in family %}
        <tr>
          <td><a href="/species/family/{{ each.id }}/{{ veg_link }}">{{ each }}</a></td>
          <td>{{ each.total }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if vegetation_types.count > 1 %}
  <div>
    <h2>Browse by vegetation type</h2>
    <table class="table table-striped datatable">
      <thead>
        <tr>
          <th>Vegetation type</th>
          <th>Species</th>
        </tr>
      </thead>
      <tbody>
      {% for each in vegetation_types %}
        <tr {% if each == vegetation_type %}class="bg-primary text-light"{% endif %}>
          <td><a href="{% url "vegetation_type_species" each.slug %}">{{ each }}</a></td>
          <td>{{ each.total }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}

{% endblock %}
